<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sudoku Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f8f9fa;
            transition: background-color 0.3s, color 0.3s;
            height: 400px;


        }
        .dark-mode {
            background-color: #121212;
            color: white;
        }
        .game-container {
            max-width: 400px;
            margin: auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            transition: background 0.3s, color 0.3s;
        }
        .dark-mode .game-container {
            background: #1e1e1e;
            color: white;
        }
        .sudoku-board {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 0;
            background: black;
            padding: 5px;
            transition: background 0.3s, border-color 0.3s;
            border: 3px solid black;
        }
        .sudoku-board div {
            width: 40px;
            height: 40px;
            text-align: center;
            font-size: 20px;
            background: white;
            border: 1px solid #bbb;
            line-height: 40px;
            transition: background 0.3s, color 0.3s, border-color 0.3s;
        }

        .sudoku-board div:nth-child(9n+1) {
            border-left: 3px solid black;
        }
        .sudoku-board div:nth-child(n+1):nth-child(-n+9) {
            border-top: 3px solid black;
        }
        .sudoku-board div:nth-child(3n) {
            border-right: 3px solid black;
        }
        .sudoku-board div:nth-child(n+19):nth-child(-n+27),
        .sudoku-board div:nth-child(n+46):nth-child(-n+54),
        .sudoku-board div:nth-child(n+73):nth-child(-n+81) {
            border-bottom: 3px solid black;
        }

        .dark-mode .sudoku-board {
            background: white;
            border-color: white;
        }
        .dark-mode .sudoku-board div {
            background: #333;
            color: white;
            border: 1px solid #bbb;
        }
        .controls {
            margin-top: 10px;
        }
        .controls button {
            margin: 5px;
            padding: 10px;
            font-size: 16px;
            cursor: pointer;
        }

.timer {
            margin-top: 10px;
            font-size: 18px;
        }

        .icons {
            position: relative;
            top: -10px;
        }
        .settings-menu {
            display: none;
            position: absolute;
            top: 50px;
            right: 20px;
            background: white;
            padding: 10px;
            border: 1px solid #ccc;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
            transition: background 0.3s, color 0.3s;
        }
        .dark-mode .settings-menu {
            background: #222;
            color: white;
            border: 1px solid #444;
        }
  

        .fixed {
            background: lightgray;
            font-weight: bold;
            pointer-events: none;
        }
        .selected {
            background: lightblue !important;
        }
        .timer {
            margin-top: 10px;
            font-size: 18px;
        }

        .incorrect {
            background-color: red !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <div class="game-container">
	<header>
        <h1>Sudoku</h1>
        <div class="icons">
            <button id="help-btn" onclick="showRules()">❓</button>
            <button id="settings-btn" onclick="toggleSettings()">⚙️</button>
        </div>
    </header>

    <div id="settings-menu" class="settings-menu">
        <label>
            <input type="checkbox" id="dark-mode-toggle" onclick="toggleDarkMode()"> Dark Mode
        </label>
    </div>

    <div class="sudoku-board" id="sudoku-board"></div>
    <div class="controls">
        <button onclick="startNewGame()">New Game</button>
        <button onclick="solveSudoku()">Solve</button>
        <button onclick="undoMove()">Undo</button>
        <button onclick="redoMove()">Redo</button>
    </div>
    <div class="timer">Time: <span id="timer">00:00</span></div>
</div>

<script>
    let undoStack = [];
    let redoStack = [];
    let timerInterval;
    let seconds = 0;

    let puzzles = [
        "530070000600195000098000060800060003400803001700020006060000280000419005000080079",
        "003020600900305001001806400008102900700000008006708200002609500800203009005010300"
    ];

    function startTimer() {
        clearInterval(timerInterval);
        seconds = 0;
        document.getElementById("timer").textContent = "00:00";
        timerInterval = setInterval(() => {
            seconds++;
            let min = Math.floor(seconds / 60).toString().padStart(2, '0');
            let sec = (seconds % 60).toString().padStart(2, '0');
            document.getElementById("timer").textContent = `${min}:${sec}`;
        }, 1000);
    }

    function saveState() {
        const boardState = Array.from(document.querySelectorAll(".sudoku-board div"))
                                .map(cell => cell.textContent);
        undoStack.push([...boardState]);
        redoStack = []; // Clear redo stack when a new move is made
    }

    function restoreState(state) {
        const cells = document.querySelectorAll(".sudoku-board div");
        cells.forEach((cell, index) => {
            cell.textContent = state[index];
        });
    }

    function undoMove() {
        if (undoStack.length > 1) {
            redoStack.push(undoStack.pop()); // Save current state to redo stack
            restoreState(undoStack[undoStack.length - 1]); // Restore previous state
        }
    }

    function redoMove() {
        if (redoStack.length > 0) {
            undoStack.push(redoStack.pop()); // Move state back to undo stack
            restoreState(undoStack[undoStack.length - 1]); // Apply redo state
        }
    }

    function generateSudoku() {
        const board = document.getElementById("sudoku-board");
        board.innerHTML = "";
        let puzzle = puzzles[Math.floor(Math.random() * puzzles.length)];
        for (let i = 0; i < 81; i++) {
            let cell = document.createElement("div");
            let num = puzzle[i] !== "0" ? puzzle[i] : "";
            cell.textContent = num;
            if (num) cell.classList.add("fixed");
            else cell.contentEditable = true;
            cell.addEventListener("input", () => {
                saveState();
                checkForInvalidInput(cell); // Check for invalid input on each input
            });
            board.appendChild(cell);
        }
        saveState();
    }

    function startNewGame() {
        generateSudoku();
        startTimer();
    }

    function isValid(board, row, col, num) {
        // Check row
        for (let i = 0; i < 9; i++) {
            if (board[row][i] == num) return false;
        }
        // Check column
        for (let i = 0; i < 9; i++) {
            if (board[i][col] == num) return false;
        }
        // Check 3x3 box
        let boxRow = 3 * Math.floor(row / 3);
        let boxCol = 3 * Math.floor(col / 3);
        for (let i = 0; i < 3; i++) {
            for (let j = 0; j < 3; j++) {
                if (board[boxRow + i][boxCol + j] == num) return false;
            }
        }
        return true;
    }

    function showRules() {
        alert("Each row, column, and 3x3 subgrid in a Sudoku puzzle must contain the numbers 1-9 without repetition. The order of numbers does not matter, but every row must include all digits from 1 to 9 exactly once, each column must follow the same rule, and each 3x3 subgrid must also contain unique numbers from 1 to 9.");
    }

    function toggleSettings() {
        const settingsMenu = document.getElementById("settings-menu");
        settingsMenu.style.display = settingsMenu.style.display === "block" ? "none" : "block";
    }

    function toggleDarkMode() {
        document.body.classList.toggle("dark-mode");
    }

    function solve(board) {
        for (let row = 0; row < 9; row++) {
            for (let col = 0; col < 9; col++) {
                if (board[row][col] == "") {
                    for (let num = 1; num <= 9; num++) {
                        if (isValid(board, row, col, num.toString())) {
                            board[row][col] = num.toString();
                            if (solve(board)) return true;
                            board[row][col] = "";
                        }
                    }
                    return false;
                }
            }
        }
        return true;
    }

    function solveSudoku() {
        let cells = document.querySelectorAll(".sudoku-board div");
        let board = [];
        for (let i = 0; i < 9; i++) board.push(Array(9).fill(""));
        cells.forEach((cell, index) => board[Math.floor(index / 9)][index % 9] = cell.textContent);
        if (solve(board)) cells.forEach((cell, index) => cell.textContent = board[Math.floor(index / 9)][index % 9]);
    }

    function checkForInvalidInput(cell) {
        const board = [];
        const cells = document.querySelectorAll(".sudoku-board div");
        cells.forEach((cell, index) => board[Math.floor(index / 9)][index % 9] = cell.textContent);

        const row = Math.floor([...cells].indexOf(cell) / 9);
        const col = [...cells].indexOf(cell) % 9;
        const value = cell.textContent;

        // Reset all previous incorrect classes
        document.querySelectorAll(".sudoku-board div").forEach(c => c.classList.remove("incorrect"));

        if (value && !isValid(board, row, col, value)) {
            cell.classList.add("incorrect"); // Highlight invalid input
        }
    }

    document.addEventListener("DOMContentLoaded", startNewGame);
</script>
</body>
</html>
